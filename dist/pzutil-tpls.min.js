/*
 * pzutil
 * 

 * Version: 0.0.18 - 2015-06-11
 * License: MIT
 */
angular.module("pzutil",["pzutil.tpls","pzutil.aditem","pzutil.adpublish","pzutil.download","pzutil.image","pzutil.modal","pzutil.rest","pzutil.retailhelper","pzutil.services","pzutil.simplegrid","pzutil.tree","pzutil.ztemplate"]),angular.module("pzutil.tpls",["template/aditem/aditem.tpl.html","template/adpublish/adpublish_grid.tpl.html","template/adpublish/adpublish_list.tpl.html","template/adpublish/adpublish_slide.tpl.html","template/modal/modal-form.html","template/modal/modal.html","template/modal/wait.html","template/simplegrid/chart.html","template/simplegrid/combo-edit.html","template/simplegrid/export.html","template/simplegrid/footer-virtual.html","template/simplegrid/footer.html","template/simplegrid/header.html","template/simplegrid/simpleGrid-dx.html","template/simplegrid/simpleGrid-normal.html","template/simplegrid/simpleGrid-simple.html","template/simplegrid/simpleGrid-virtual.html","template/simplegrid/simpleGrid.html"]),angular.module("pzutil.aditem",[]).directive("adItem",["rest",function(){return{restrict:"E",scope:{item:"=",itemClass:"=",itemStyle:"="},templateUrl:"template/aditem/aditem.tpl.html",link:function(a){a.getItemTemplate=function(){switch(a.item.type){case 0:return"html.tpl.html";case 1:return"taxonImage.tpl.html";case 2:return"productImagePrice.tpl.html";case 3:return"promotion.tpl.html";case 4:return"imageClickable.tpl.html";case 5:return"imageNotClickable.tpl.html"}},a.itemStyle=angular.fromJson(a.itemStyle)||{},console.log(a.itemClass)}}}]),angular.module("pzutil.adpublish",[]).directive("adPublish",["rest","retailHelper",function(a,b){return{restrict:"E",scope:{place:"=",itemClass:"@",itemStyle:"@"},templateUrl:function(a,b){return b.template?"template/adpublish/"+b.template+".tpl.html":3==b.place?"template/adpublish/adpublish_slide.tpl.html":"template/adpublish/adpublish_grid.tpl.html"},link:function(c){c.loading=!0,a.callApi("adpublish",{place:c.place}).then(function(d){switch(c.items=d.data[0],c.place){case 0:c.placeText="adpublish.place.feature";break;case 1:c.placeText="adpublish.place.new";break;case 2:c.placeText="adpublish.place.staffPick";break;case 50:c.placeText="adpublish.place.adminHighlights"}_(c.items).forEach(function(c){c.props=angular.fromJson(c.props)||{},2==c.type&&a.callApi("getProduct",{pid:c.props.product}).then(function(a){c.product=a.data[0][0];var d=_.max(a.data[1],"retail"),e=_.min(a.data[1],"retail");c.product.retail=b.getRetail(e.retail,d.retail);var f=[];_(a.data[1]).forEach(function(a){a.images&&_(a.images.split(",")).forEach(function(a){f.push(a)})}),c.product.images=f,f.length>0&&(c.product.image=f[0])})}),c.loading=!1})}}}]),angular.module("pzutil.download",[]).factory("downloadHelper",["$http","$q",function(a,b){var c={};return c.downloadFile=function(c,d,e){var f=b.defer(),g={responseType:"arraybuffer"};return g.data=e,g.url=c,g.method=d,a(g).success(function(a,b,c){var d="application/octet-stream",e=!1;c=c();var g=c["x-filename"]||"download.bin",h=c["content-type"]||d;try{console.log("Trying saveBlob method ...");var i=new Blob([a],{type:h});if(navigator.msSaveBlob)navigator.msSaveBlob(i,g);else{var j=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;j&&(j(i,g),console.log("saveBlob succeeded"),e=!0,f.resolve(g))}}catch(k){console.log("saveBlob method failed with the following exception:"),console.log(k)}if(!e){var l=window.URL||window.webkitURL||window.mozURL||window.msURL;if(l){var m=document.createElement("a");if("download"in m)try{console.log("Trying download link method with simulated click ...");var i=new Blob([a],{type:h}),n=l.createObjectURL(i);m.setAttribute("href",n),m.setAttribute("download",g);var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),m.dispatchEvent(o),console.log("Download link method with simulated click succeeded"),e=!0,f.resolve(g)}catch(k){console.log("Download link method with simulated click failed with the following exception:"),console.log(k),f.reject("Download link method with simulated click failed with the following exception:: "+k)}}}}).error(function(a,b){console.log("Request failed with status: "+b),console.log("Request failed with data: ",g.data),f.reject("Request failed with status: "+b)}),f.promise},c}]),angular.module("pzutil.image",[]).factory("imageHelper",[function(){var a={getUrl:function(a,b){return"http://portalvhdsmzdfsgd15ll8f.blob.core.windows.net/"+(b?b+"/":"")+a}};return a}]).filter("zImageUrl",["imageHelper",function(a){return function(b,c){return a.getUrl(b,c)}}]),angular.module("pzutil.modal",[]).directive("crudModal",function(){return{restrict:"E",replace:!0,transclude:"element",templateUrl:"template/modal/modal.html"}}).directive("crudModalForm",function(){return{restrict:"E",replace:!0,transclude:"element",templateUrl:"template/modal/modal-form.html"}}).factory("crudWait",["$http","$modal",function(a,b){var c={doWork:function(a,c,d){var e=b.open({templateUrl:"template/modal/wait.html",controller:"crudWaitCtrl",resolve:{msg:function(){return a}}});e.result.then(function(){},function(){}),c.then(function(){d(),e.close()})}};return c}]).controller("crudWaitCtrl",["$scope","$modalInstance","msg",function(a,b,c){a.msg=c}]),angular.module("pzutil.rest",[]).factory("rest",["$http",function(a){var b="/api/public",c={callApi:function(c,d){return d=d||{},d.aid=2,a.post(b+"/"+c,d)}};return c}]),angular.module("pzutil.retailhelper",[]).factory("retailHelper",[function(){var a={getRetail:function(a,b){return a==b?accounting.formatMoney(b):accounting.formatMoney(a)+" ~ "+accounting.formatMoney(b)}};return a}]),angular.module("pzutil.services",[]).factory("attrHelper",[function(){var a={parseIds:function(a,b,c){if(c){var a=a.split(",");return _.map(b.filterFunction(function(b){return a.indexOf(b)>-1}).top(1/0),"name").join(", ")}var d=[];return _(a.split(",")).forEach(function(a){var c=_.find(b,{id:a});c&&d.push(c.name)}),d.join(", ")}};return a}]).factory("localizedMessages",["$interpolate","I18N.MESSAGES",function(a,b){var c=function(a,b){return a||b};return{get:function(d,e){var f=b[d];return f?a(f)(e):c(f,d)},rawGet:function(a){return b[a]}}}]).filter("i18n",["localizedMessages",function(a){return function(b){return a.get(b)}}]).directive("i18n",["localizedMessages",function(a){var b={restrict:"EAC",updateText:function(b,c){b.text(a.get(c,interpolateParams))},link:function(a,c,d){d.$observe("i18n",function(){b.updateText(c,d.i18n)})}};return b}]).directive("i18nAttr",["localize",function(a){var b={restrict:"EAC",updateText:function(b,c){b.text(a.get(c,interpolateParams))},link:function(a,c,d){d.$observe("i18nAttr",function(a){b.updateText(c,a)})}};return b}]),angular.module("pzutil.simplegrid",["pzutil.services","pzutil.modal"]).factory("sgColumn",["localizedMessages",function(a){var b=function(b){var c=b.sorter,d=b.myLookup,e=b.myLookupTitle,f=b.sgAgg,g=b.charter,h=b.modalEdit,i=(b.clickRow,function(a,c){a.checkbox=b.sgCheckColumn==a.name,a._width=a.width||2,a._index=c,delete a.width,angular.extend(this,a)});return Object.defineProperty(i.prototype,"width",{get:function(){return 0==this._index&&b.sgAllowDel&&!b.sgReadonly?this._width-.5:this._width}}),i.sorter=c,i.charter=g,i.New=function(a){return new i(a)},i.Parse=function(a){if(a){for(var b=angular.fromJson(a),c=[],d=0;d<b.length;d++)c.push(new i(b[d],d));return c}},i.prototype.$getTitle=function(){if(this.res)return a.get(this.res);var b=this.name;return e&&(b=e({col:b})),b||this.name},i.prototype.showSpan=function(a){return b.sgReadonly?!0:this.template||this.editTemplate?this.template&&a.$core&&a.$core()&&"readonly_"!=this.template.substr(0,9)?!0:!1:!0},i.prototype.$getColumnClass=function(a){var c=this.width?this.width:2,d=this.checkbox?"checkbox checkbox-cell ":"",e=a&&a.inactive;return e&&(d+="sg-deleted "),b.hasEditInput()&&(d+="sg-gridrow-cell-edit "),c="col-sg-"+2*c,this.align&&a?d+"sg-gridrow-cell "+c+" text-"+this.align:d+"sg-gridrow-cell "+c},i.prototype.$modalEdit=function(a,b){this.modalEdit&&h(a,this,$(b.target))},i.prototype.$getComboKey=function(a){switch(a){case 1:return"comboActiveIdx_"+this.name;case 2:return"comboIsOpen_"+this.name;case 3:return"comboSelect_"+this.name;case 4:return"comboPosition_"+this.name;default:return"comboList_"+this.name}},i.prototype.$sort=function(){this.sortOrder=!this.sortOrder,i.sorter(this)},i.prototype.$chart=function(){i.charter(this)},i.prototype.$getText=function(a){var b=a[this.name];return this.bool?"":(d&&(b=d({col:this.name,value:b,item:a})),b)},i.prototype.$getValue=function(a){var b=a[this.name];return d&&(b=d({col:this.name,value:b,item:a})),b},i.prototype.$aggregate=function(){return f({col:this.name})},i};return b}]).factory("simpleGridExport",["$modal","$location","$q","zTreeHelper",function(a,b,c){var d={"export":function(b,d,e){var f=c.defer(),g=a.open({templateUrl:"template/simplegrid/export.html",controller:"simpleGridExportCtrl",resolve:{docTitle:function(){return e},columns:function(){var a=[];return _(b).forEach(function(b){a.push({name:b.name,title:b.$getTitle()})}),a},data:function(){var a=[];return _(d).forEach(function(c){var d={};_(b).forEach(function(a){d[a.name]=a.$getValue(c)}),a.push(d)}),a}}});return g.result.then(function(a){f.resolve(a)},function(){f.reject()}),f.promise}};return d}]).controller("simpleGridExportCtrl",["$scope","$modalInstance","columns","data","docTitle","downloadHelper","localizedMessages","browser",function(a,b,c,d,e,f,g,h){a.item={},a.columns=c,a.data=d,a.groupbys=[],_(c).forEach(function(b){a.groupbys.push({id:b.name,name:b.title})}),a.formats=[{id:"xlsx",name:"xlsx"},{id:"csv",name:"csv"}],a.heading=function(){return g.get("common.Export")+" "+(e||"")},a.ok=function(){var c={columns:a.columns,data:a.data,format:a.item.format,groupby:a.item.groupby,title:e};h.s2kagent?alert("__excel"+JSON.stringify(c)):f.downloadFile("/pzobject/excel","post",c).then(function(){b.close()},function(a){alert(a.message)})},a.cancel=function(){b.dismiss("cancel")}}]).directive("contextMenu",function(){var a=function(a,b,c){if(!d)var d=angular.element;d(b.currentTarget).addClass("context");var e=d("<div>");e.addClass("dropdown clearfix");var f=d("<ul>");f.addClass("dropdown-menu"),f.attr({role:"menu"}),f.css({display:"block",position:"absolute",left:b.pageX+"px",top:b.pageY+"px"}),angular.forEach(c,function(c){var g=d("<li>");null===c?g.addClass("divider"):($a=d("<a>"),$a.attr({tabindex:"-1",href:"#"}),$a.text("string"==typeof c[0]?c[0]:c[0].call(a,a)),g.append($a),g.on("click",function(f){f.preventDefault(),a.$apply(function(){d(b.currentTarget).removeClass("context"),e.remove(),c[1].call(a,a)})})),f.append(g)}),e.append(f);var g=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);e.css({width:"100%",height:g+"px",position:"absolute",top:0,left:0,zIndex:9999}),d(document).find("body").append(e),e.on("mousedown",function(a){d(a.target).hasClass("dropdown")&&(d(b.currentTarget).removeClass("context"),e.remove())}).on("contextmenu",function(a){d(a.currentTarget).removeClass("context"),a.preventDefault(),e.remove()})};return function(b,c,d){var e=b.$eval(d.contextMenu);e instanceof Array&&c.on("contextmenu",function(c){b.$apply(function(){c.preventDefault(),a(b,c,e)})})}}).directive("comboEditPopup",function(){return{restrict:"EA",scope:{items:"=",active:"=",isopen:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/simplegrid/combo-edit.html",link:function(a){a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("simpleGridChart",[function(){return{restrict:"E",replace:!0,scope:{scChartType:"=",scCategory:"=",scSeries:"=",scData:"=",scSeriesClick:"&",scKeylookup:"&",scInstance:"="},templateUrl:"template/simplegrid/chart.html",link:function(a){a.items_chart=[],a.items=new kendo.data.DataSource({data:[]}),a.scChartInstance=a.scChartInstance||{};var b=function(){if(a.items_chart.length=0,a.scData.length>0){var b;if(a.scData[0].hasOwnProperty(a.scCategory))b=_.groupBy(a.scData,a.scCategory);else{var c=[];_(a.scData).forEach(function(a){c.push.apply(c,a.lines)}),b=_.groupBy(c,a.scCategory)}for(var d in b){var e={category:a.scKeylookup({col:a.scCategory,value:b[d][0][a.scCategory]})};a.items_chart.push(e),_(b[d]).forEach(function(b){_(a.scSeries).forEach(function(a){var c=a.field,d=e[c]||0;e[c]=d+(b[c]||0)})})}}if(a.items_chart.length>0){var f=a.items_chart[0][a.scCategory];if(!angular.isString(f)||!moment(f).isValid()){var g=a.scSeries[0].field;if(a.items_chart.sort(function(a,b){return b[g]-a[g]}),a.items_chart.length>10){var h={};h[a.scCategory]="(Other)";for(var i=a.items_chart.length-10,j=0;i>j;){var k=a.items_chart.pop();_(a.scSeries).forEach(function(a){var b=a.field,c=h[b]||0;h[b]=c+(k[b]||0)}),j++}a.items_chart.push(h)}}}if(a.items.data(a.items_chart),a.kendoInstance){var l=a.kendoInstance.options;l.series.length=0,_(a.scSeries).forEach(function(a){l.series.push(new Object),l.series[l.series.length-1].field=a.field,l.series[l.series.length-1].name=a.name}),a.kendoInstance.refresh()}};a.scInstance=a.scInstance||{},a.scInstance.refresh=b,a.$watchCollection(function(){return a.scData},b)}}}]).directive("simpleGrid",["sgColumn","breadcrumbs","localizedMessages","crudWait","$modal","simpleGridExport","$timeout","$position","$compile","$document","httpRequestTracker",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",replace:!0,scope:{data:"=sgData",listItems:"=",sgAddObject:"&",sgSortOptions:"=",itemtemplate:"=sgTemplate",sgColumns:"@",sgDelObject:"&",sgAllowDel:"@",sgNoPager:"=",sgOnClick:"&",sgLookup:"&",sgGlobalSearch:"@",sgLocalSearch:"@",sgPageSize:"@",sgOptions:"=",sgOnChange:"&",sgLookupTitle:"&",sgSortField:"=",sgVirtual:"@",sgCheckColumn:"@",sgCustomSearch:"&",sgModalSearchTemplate:"=",sgModalSearchController:"=",sgModalSearchResolve:"=",sgModalSearch:"&",sgExportTitle:"@",sgPublic:"=",sgAgg:"&",sgReadonly:"=",sgMenu:"=",sgModalEdit:"&",sgFlexWidth:"="},templateUrl:function(a,b){var c=b.sgTemplate;if(c){var d=".grid.tpl.html'";return-1!==c.indexOf(d,c.length-d.length)?"template/simplegrid/simpleGrid-simple.html":"template/simplegrid/simpleGrid.html"}return b.sgVirtual?"template/simplegrid/simpleGrid-virtual.html":"template/simplegrid/simpleGrid-normal.html"},link:function(d,k,l){function m(){if(d.columns&&d.columns.length>0){var a=_.find(d.columns,{name:s.initSort})||d.columns[0];a.sortOrder=s.initSortOrder,d.sorter(a)}}function n(){var a=s.pageSize,b=d.gridData,e=s.currentPage,f=_.take(_.rest(b,(e-1)*a),a);d.items?(d.items.length=0,d.items.push.apply(d.items,f)):d.items=f,s.totalItems=b.length,d.footer=c.get(s.totalItems<=s.pageSize?"common.totalcount1Page":"common.totalcount",{from:a*(e-1)+1,to:Math.min(a*e,s.totalItems),total:s.totalItems,size:s.pageSize})}d.hasSummary=!!l.sgAgg;var o=d.$new();k.on("$destroy",function(){d.$destroy()}),d.$on("$destroy",function(){for(;q.length>0;)q.pop().remove();o.$destroy()}),d.modalEdit=function(a,b,c){var e=b.$getComboKey(4);o[e]=h.offset(c),o[e].top=o[e].top+c.prop("offsetHeight"),d.activeRow=a,o[b.$getComboKey(2)]=!0,c.attr("aria-expanded",!0)};var p=function(a,b,c,e){var f=new Date,c=c||a;_(d.columns).forEach(function(b){b.name!=a&&(b.sortOrder=void 0)});var g=crossfilter.quicksort.by(function(a){var b;return b=!a.hasOwnProperty(c)||e?d.myLookup?d.myLookup({col:c,item:a}):void 0:a[c],angular.isString(b)&&(b=b.toLowerCase()),b});g(d.gridData,0,d.gridData.length),b||d.gridData.reverse(),n(),console.log("sort",new Date-f)};d.scInstance={},d.chartSeries=[],d.charter=function(a){var b=d.chartSeries,c=_.find(b,{field:a.name});if(c){var e=b.indexOf(c);b.splice(e,1)}else b.push({field:a.name,name:a.$getTitle()});if(0==b.length)d.chartCategory=void 0;else{var f=_.find(d.columns,{chartCategory:!0});f&&(d.chartCategory==f.name?d.scInstance.refresh():d.chartCategory=f.name)}},d.sorter=function(a){s.initSort=a.name,s.initSortOrder=a.sortOrder,p(a.name,a.sortOrder,a.sortField,a.useLookup)},d.AddObject=function(){d.data.push(a.New(d.sgAddObject()))},d.DelObject=function(a){if(confirm(c.get("common.del"))){var b=d.data.indexOf(a);d.data.splice(b,1),d.sgDelObject&&d.sgDelObject(a)}},d.chartLookup=function(a,b){return d.myLookup?d.myLookup({col:a,value:b}):b},d.clickRow=function(a,b){b.ctrlKey?a.$__selected=!a.$__selected:d.sgOnClick(a.hasOwnProperty("id")?angular.isFunction(a.$core)&&a.$core()&&a.hasOwnProperty("accountid")?{id:a}:{id:a.id}:{id:a})},d.myLookup=l.sgLookup?d.sgLookup:null,d.myLookupTitle=l.sgLookupTitle?d.sgLookupTitle:null,d.columns=a(d,d.sgFlexWidth).Parse(l.sgColumns),d.getRowCss=function(a){return(d.sgFlexWidth?"row-fluid sg-nowrap ":"row ")+a},d.getCellStyle=function(){return d.sgFlexWidth?"display: inline-block;":""};var q=[];if(d.hasEditInput=function(){return d.sgReadonly?!1:!!_.find(d.columns,function(a){return a.template&&"readonly_"!=a.template.substr(0,9)})},_(d.columns).forEach(function(a){if(a.modalEdit){var b=a.$getComboKey(1),c=a.$getComboKey(0),e=a.$getComboKey(3);o[e]=function(a,b,c){return function(e){d.activeRow[a]=o[b][e].id,o[c]=!1}}(a.name,a.$getComboKey(0),a.$getComboKey(2)),o[c]=d.sgModalEdit({col:a.name});var f=angular.element("<div combo-edit-popup></div>");f.attr({items:c,active:b,select:e+"(activeIdx)",position:a.$getComboKey(4),isopen:a.$getComboKey(2)});var g=i(f)(o);f.remove(),j.find("body").append(g),q.push(g)}}),Object.defineProperty(d,"activeRow",{get:function(){return d.__activeRow},set:function(a){d.__activeRow=a,_(d.columns).forEach(function(b){if(b.modalEdit){var c=b.$getComboKey(1),d=b.$getComboKey(0),e=a[b.name],f=o[d],g=_.find(f,{id:e});o[c]=f.indexOf(g)}})}}),d.sortGrid=function(a){if(d.sgSortOptions){var b=_.find(d.sgSortOptions,{selected:!0});b&&p(b.name,a)}},d.export=function(){var a;a=d.sgExportTitle?c.get(d.sgExportTitle):"Table";var b=d.listItems&&0!=d.listItems.length?d.listItems:d.data;f.export(d.columns,b,a)},d.scrollStyle=l.gridHeight?"max-height:"+l.gridHeight+";overflow-y:auto":"",d.modalSearchReset=function(){s.modalSearchCriteria&&(s.modalSearchCriteria=void 0,d.changed(s.currentPage))},d.modalSearch=function(){var a=d.sgModalSearchResolve;a.item=function(){return s.modalSearchCriteria||{}};var b=e.open({templateUrl:d.sgModalSearchTemplate,controller:d.sgModalSearchController,resolve:d.sgModalSearchResolve});b.result.then(function(a){s.modalSearchCriteria=a,d.changed(s.currentPage)},function(){})},d.checkAll=function(){d.checkedAll=!d.checkedAll,_(d.items).forEach(function(a){a.$__selected=d.checkedAll})},d.resetChecks=function(){var a=_.find(d.columns,{name:d.sgCheckColumn});a&&(a.checkedAll=!1),_(d.items).forEach(function(a){a.hasOwnProperty("$__selected")&&delete a.$__selected})},d.getIndex=function(a){return d.items.indexOf(a)+1},d.public=d.sgPublic||{},d.public.resetSearch=function(){b.listingSearchModel=d.sgGlobalSearch},d.public.refresh=d.changed=function(a,b){var c=s.pageSize;a=a||s.currentPage,s.currentPage=a,b&&d.resetChecks();var e=(d.data,null);if((d.sgGlobalSearch||d.sgLocalSearch)&&d.searchService.listingSearch&&""!=d.searchService.listingSearch){var f=d.searchService.listingSearch.toLowerCase();e=d.crossfilter.filterFunction(function(a){return a.toLowerCase().indexOf(f)>-1}).top(1/0),s.totalItems=e.length;var g=Math.ceil(s.totalItems/c);a>g&&(a=1,s.currentPage=a)}else e=d.crossfilter.filterAll().top(1/0);s.modalSearchCriteria&&d.sgModalSearchTemplate&&(e=d.sgModalSearch({list:e,c:s.modalSearchCriteria,lk:d.myLookup})),d.listItems&&angular.isArray(d.listItems)&&(d.listItems.length=0,d.listItems.push.apply(d.listItems,e)),d.gridData=e,m()},d.sgGlobalSearch||d.sgLocalSearch)if(d.$watch(function(){return d.searchService.listingSearch},function(){!function(a){g(function(){a==d.searchService.listingSearch&&d.changed(s.currentPage)},500)}(d.searchService.listingSearch)}),d.sgGlobalSearch){var r=b.setlistingSearchModel(d.sgGlobalSearch);r.listingPageSetting||(r.listingPageSetting={}),d.pageSetting=r.listingPageSetting,d.searchService=b}else d.pageSetting={},d.searchService={};else d.pageSetting={},d.searchService={};var s=d.pageSetting;s.hasOwnProperty("pageSize")||(s.pageSize=d.sgNoPager?100:d.sgPageSize?parseInt(d.sgPageSize):20,s.currentPage=1),s.totalItems=d.data.length,s.initSort||(s.initSort=d.sgSortField,s.initSortOrder=!0,s.initSort&&"!"==s.initSort.substr(0,1)&&(s.initSortOrder=!1,s.initSort=s.initSort.substr(1))),d.$watchCollection(function(){return d.data},function(){var a=new Date;d.crossfilter=crossfilter(d.data).dimension(function(a){for(var b="",c=0;c<d.columns.length;c++){var e=d.columns[c].name,f=a[e];d.myLookup&&(f=d.myLookup({col:e,value:f,item:a})),f&&(b+="|"+f)}return b}),console.log("crossfilter",new Date-a),d.changed(s.currentPage)})}}}]),angular.module("pzutil.tree",[]).factory("zTreeHelper",[function(){var a=function(b,c,d,e,f,g){var h=_.filter(b,function(a){var b=a.parentid?a.parentid:0;return e?null==c?a[e]==d&&0==b:b==c.id&&a[e]==d:null==c?0==b:b==c.id});if(h=_.sortBy(_.sortBy(h,"name"),"position"),null!=c&&(c.children=h),f||g){var g=1;_(h).forEach(function(c){g&&(c.position=g),f&&a(b,c,d,e,f,g),g++})}return h},b=function(a,c,d,e){_(e).forEach(function(e){var f=d+e.name;e[c]&&a.push({id:e.id,name:f}),b(a,c,e.id?f+" >> ":"",e.children)})},c=function(a,b,c,d,e){var f,g=d[c],h=0;return g?(h=d.parentid?d.parentid:0,f=(0==h?_.find(a,{id:g}):_.find(b,{id:h})).children):f=a,e?_.findLast(f,function(a){var b=a.parentid?a.parentid:0;return console.log(a.position.toString()+":"+d.position.toString()),h==b&&a.position<d.position}):_.find(f,function(a){var b=a.parentid?a.parentid:0;return h==b&&a.position>d.position})},d=function(){return uuid.v4()},e={updateTreeValue:function(a,b,c,d){switch(d){case"2":var e=a[b];if(e){var f=e.split(",");_(c.split(",")).forEach(function(a){var b=f.indexOf(a);b>=0&&f.splice(b,1)}),a[b]=f.join(",")}break;case"1":a[b]=c;break;default:var e=a[b];if(e){var f=e.split(",");_(c.split(",")).forEach(function(a){f.indexOf(a)<0&&f.push(a)}),a[b]=f.join(",")}else a[b]=c}},buildTree:function(b,c,d,e,f){if(d){var g=1;f&&b.sort(function(a,b){return a.position-b.position}),_(b).forEach(function(b){f&&(b.position=g),b.children=a(c,null,b.id,d,e,f),g++})}else a(c,null,null,d,e,f)},addTreeItem:function(a,b,c,e,f,g,h){if(a){if(a.root&&f){var i=f();i.children=[],i.id=d(b),b.push(i)}else{var i=g();i.children=[],i.id=d(c),e?a[e]?(i[e]=a[e],i.parentid=a.id):i[e]=a.id:a.root||(i.parentid=a.id),c.push(i)}h()}},moveTreeItem:function(a,b,d,e,f,g){var h=c(a,b,d,e,f);if(h){var i=e.position;e.position=h.position,h.position=i,g()}},buildDropdownList:function(a,c){var d=[];return b(d,a,"",c),d}};return e}]),angular.module("pzutil.ztemplate",["pzutil.services"]).directive("zTemplate",["localizedMessages","$compile",function(a,b){return{restrict:"A",scope:!1,compile:function(){return function(a,c,d){var e=c.scope(),f=e.$eval(d.zTemplate);c.append(b(f)(e))}}}}]),angular.module("template/aditem/aditem.tpl.html",[]).run(["$templateCache",function(a){a.put("template/aditem/aditem.tpl.html",'<script type="text/ng-template"  id="html.tpl.html">\n    <div ng-style="itemStyle" ng-class="itemClass"  >\n        <span z-template="item.props.html" ></span>\n    </div>\n</script>\n<script type="text/ng-template"  id="taxonImage.tpl.html">\n    <a href="#" target="_blank">\n        <img ng-src="{{item.props.images | zImageUrl:\'s2kcontainer\'}}" ng-style="itemStyle" ng-class="itemClass"  />\n        <div class="carousel-caption">\n            <p>{{item.props.title}}</p>\n        </div>\n    </a>\n\n</script>\n<script type="text/ng-template"  id="productImagePrice.tpl.html">\n    <a href="product/{{item.product.productid}}" target="_blank">\n        <img ng-src="{{item.product.image | zImageUrl:\'s2kcontainer\'}}"  ng-style="itemStyle" ng-class="itemClass"  />\n        <div class="carousel-caption">\n            <p>{{item.product.retail}}</p>\n        </div>\n    </a>\n</script>\n<script type="text/ng-template"  id="promotion.tpl.html">\n    <a href="#" target="_blank">\n        <img ng-src="{{item.props.images | zImageUrl:\'s2kcontainer\'}}"  ng-style="itemStyle"  ng-class="itemClass" />\n        <div class="carousel-caption">\n            <p>{{item.props.title}}</p>\n        </div>\n    </a>\n\n</script>\n<script type="text/ng-template"  id="imageClickable.tpl.html">\n    <a href="{{item.props.targetUrl}}" target="_blank">\n        <img ng-src="{{item.props.images | zImageUrl:\'s2kcontainer\'}}" ng-style="itemStyle"  ng-class="itemClass"/></a>\n</script>\n<script type="text/ng-template"  id="imageNotClickable.tpl.html">\n    <img ng-src="{{item.props.images | zImageUrl:\'s2kcontainer\'}}" ng-style="itemStyle"  ng-class="itemClass" />\n</script>\n<div ng-include="getItemTemplate()">\n</div>\n\n')}]),angular.module("template/adpublish/adpublish_grid.tpl.html",[]).run(["$templateCache",function(a){a.put("template/adpublish/adpublish_grid.tpl.html",'<div>\n    <div  ng-if="!loading && items && items.length">\n        <div class="page-header" >\n            <h3>{{ placeText | i18n }}</h3>\n        </div>\n        <div ng-repeat="item in items" class="col-md-4" style="padding-top:10px;padding-bottom: 10px">\n            <ad-item item="item" item-class="itemClass" item-style="itemStyle"></ad-item>\n        </div>\n    </div>\n    <i class="fa fa-spinner fa-spin fa-2x" ng-if="loading" style="position: absolute;left: 50%;top: 50%;"/>\n</div>\n\n')}]),angular.module("template/adpublish/adpublish_list.tpl.html",[]).run(["$templateCache",function(a){a.put("template/adpublish/adpublish_list.tpl.html",'<div>\n    <div  ng-if="!loading && items && items.length">\n        <div ng-repeat="item in items" class="col-md-12" style="padding-top:10px;padding-bottom: 10px">\n            <ad-item item="item" item-class="itemClass" item-style="itemStyle"></ad-item>\n        </div>\n    </div>\n    <i class="fa fa-spinner fa-spin fa-2x" ng-if="loading" style="position: absolute;left: 50%;top: 50%;"/>\n\n</div>\n\n')}]),angular.module("template/adpublish/adpublish_slide.tpl.html",[]).run(["$templateCache",function(a){a.put("template/adpublish/adpublish_slide.tpl.html",'<div>\n    <div  ng-if="!loading">\n        <carousel interval="5000">\n            <slide ng-repeat="item in items" active="item.active">\n                <ad-item item="item" item-class="itemClass" item-style="itemStyle"></ad-item>\n            </slide>\n        </carousel>\n    </div>\n    <i class="fa fa-spinner fa-spin fa-2x" ng-if="loading" style="position: absolute;left: 50%;top: 50%;"/>\n</div>')}]),angular.module("template/modal/modal-form.html",[]).run(["$templateCache",function(a){a.put("template/modal/modal-form.html",'<div>\n    <div class="modal-header">\n        <h3>{{heading()}}</h3>\n    </div>\n    <div ng-transclude></div>\n</div>')}]),angular.module("template/modal/modal.html",[]).run(["$templateCache",function(a){a.put("template/modal/modal.html",'<div>\n    <div class="modal-header">\n        <h3>{{heading()}}</h3>\n    </div>\n    <div class="modal-body">\n        <div ng-transclude></div>\n    </div>\n    <div class="modal-footer">\n        <div class="btn-toolbar page-header-ztree" role="toolbar">\n            <button type="button" class="btn btn-default"  ng-click="ok()"><i class="fa fa-save"></i> OK</button>\n            <button type="button" class="btn btn-default" ng-click="cancel()"><i class="fa fa-undo"></i> Cancel</button>\n        </div>\n    </div>\n</div>')}]),angular.module("template/modal/wait.html",[]).run(["$templateCache",function(a){a.put("template/modal/wait.html",'<div class="modal-body">\n    <div class="progress progress-striped active">\n        <div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n            {{msg}}\n        </div>\n    </div>\n</div>')}]),angular.module("template/simplegrid/chart.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/chart.html",'<div kendo-chart="kendoInstance"\n     k-chart-area=\'{background: "#ffffff"}\'\n     k-category-axis=\'{field: "category"}\'\n     k-legend="{ position: \'bottom\' }"\n     k-series-defaults="{ type: scChartType }"\n     k-series="scSeries"\n     k-data-source="items"\n     k-theme="\'silver\'"\n     k-series-hover="scSeriesClick"></div>')}]),angular.module("template/simplegrid/combo-edit.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/combo-edit.html",'<ul class="dropdown-menu zscrollable-menu" role="menu" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: \'200px\'}" style="display: block;position:absolute;z-index: 100000" aria-hidden="{{!isopen}}" ng-show="isopen">\n    <li ng-repeat="item in items track by $index" role="presentation">\n        <a href ng-click="selectMatch($index);$event.stopPropagation();" role="menuitem">\n            <i ng-class="{true: \'fa fa-circle\', false: \'fa fa-circle-o\'}[isActive($index)]"></i> {{item.name}}\n        </a>\n    </li>\n</ul>')}]),angular.module("template/simplegrid/export.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/export.html",'<crud-modal>\n    <form name="form"  class="form-horizontal">\n        <div class="form-group">\n            <z-input res="common.Export.format" cols="2,6" for="format" type="select" z-options="t.id as t.name for t in formats| orderBy:\'name\'" required></z-input>\n        </div>\n        <div class="form-group">\n            <z-input res="common.Export.groupby" cols="2,6" for="groupby" type="mselect" data="groupbys"></z-input>\n        </div>\n    </form>\n</crud-modal>\n')}]),angular.module("template/simplegrid/footer-virtual.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/footer-virtual.html",'<div class="row">\n    <div class="col-md-9">\n        Total # Of Records: <strong>{{pageSetting.totalItems}}</strong>\n    </div>\n</div>')}]),angular.module("template/simplegrid/footer.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/footer.html",'<div class="row sg-gridrow" ng-if="hasSummary">\n    <div class="col-sg-1" ng-if="sgAllowDel && !sgReadonly" ></div>\n    <div class="{{col.$getColumnClass({})}}" ng-repeat="col in columns">\n        <span class="text-success">{{col.$aggregate()|picker:col.format}} <i class="fa fa-bar-chart sg_gridIcon text-info" ng-if="!!col.chartSeries" ng-click="col.$chart()" style="top:50%;"></i></span>\n    </div>\n</div>\n<div class="row">\n    <div class="col-md-9">\n        <pagination ng-if="!sgNoPager && pageSetting.totalItems>pageSetting.pageSize"\n                    total-items="pageSetting.totalItems" page="pageSetting.currentPage" items-per-page="pageSetting.pageSize" rotate="false"\n                    max-size="5" class="pagination-sm" boundary-links="true"  on-select-page="changed(page, true)" />\n    </div>\n    <div class="col-md-3 sg-footer">\n        <strong><a href="#" editable-number="pageSetting.pageSize" e-min="20" e-max="400" onaftersave="changed(1)">\n            {{footer}}</a> </strong>\n    </div>\n</div>')}]),angular.module("template/simplegrid/header.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/header.html",'<div class="row well well-sm sg-gridSearch"  ng-if="sgModalSearchTemplate || sgExportTitle" >\n    <button type="button" class="btn btn-success"  ng-click="modalSearch()" ng-if="sgModalSearchTemplate"><i class="fa fa-search"></i> {{\'common.searchAdv\' | i18n}}</button>\n    <button type="button" class="btn btn-default"  ng-click="modalSearchReset()" ng-if="sgModalSearchTemplate"><i class="fa fa-undo"></i> {{\'common.Reset\' | i18n}}</button>\n    <button type="button" class="btn btn-default"  ng-click="export()"><i class="fa fa-file-excel-o"></i> {{\'common.Export\' | i18n}}</button>\n    <button type="button" class="btn btn-default pull-right"  ng-click="checkAll()" ng-if="sgModalSearchTemplate"><i class="fa fa-check"></i> {{\'common.checkAll\' | i18n}}</button>\n    <span class="pull-right" style="margin-right: 10px"  ng-if="sgModalSearchTemplate"><small>To select, press <kbd>CTRL</kbd> key to click</small></span>\n    <input type="text" placeholder="Search" class="pull-right form-control" ng-model="searchService.listingSearch" ng-if="sgLocalSearch" style="width: auto">\n</div>\n<div class="{{getRowCss(\'sg-gridheader\')}}" >\n    <div class="col-sg-1" ng-if="sgAllowDel && !sgReadonly" ></div>\n    <div class="{{col.$getColumnClass()}}" ng-click="col.$sort()" ng-repeat="col in columns">\n        <span>{{col.$getTitle()}}</span>\n        <i class="fa fa-long-arrow-down pull-right sg_gridIcon" ng-show="!col.sortOrder && col.sortOrder!=undefined" style="top:50%;"></i>\n        <i class="fa fa-long-arrow-up pull-right sg_gridIcon" ng-show="col.sortOrder" style="top:50%;"></i>\n    </div>\n</div>')
}]),angular.module("template/simplegrid/simpleGrid-dx.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid-dx.html",'<div class="sg-grid">\n    <ng-include src="\'template/simplegrid/header.html\'"></ng-include>\n    <div style="{{scrollStyle}}">\n        <div ng-repeat="item in items" class="row sg-gridrow" ng-click="clickRow(item,$event)" ng-class="{true: \'sg-gridrow-active\'}[item.$__selected]" >\n            <div class="{{col.$getColumnClass(item)}}" ng-repeat="col in columns">\n                <i ng-if="$first && item.$__selected" class="fa fa-circle"></i>\n                <i ng-if="col.bool" ng-class="{true: \'fa fa-check\'}[col.$getValue(item)]"></i>\n                <a href ng-if="$first && sgAllowDel" ng-click="DelObject(item)"><i class= \'glyphicon glyphicon-remove\'></i></a>\n                <ng-include  ng-if="col.template && (col.template.substr(0,9)==\'readonly_\' || !item.$core || !item.$core())" src="col.template"></ng-include>\n                <span ng-if="!col.template || (item.$core && item.$core() && col.template.substr(0,9)!=\'readonly_\')">{{col.$getText(item)}}</span>\n                <i ng-if="$last && item.$core && item.$core()" class="fa fa-lock pull-right sg_gridIcon"></i>\n            </div>\n        </div>\n    </div>\n    <ng-include src="\'template/simplegrid/footer.html\'"></ng-include>\n</div>')}]),angular.module("template/simplegrid/simpleGrid-normal.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid-normal.html",'<div class="sg-grid">\n    <ng-include src="\'template/simplegrid/header.html\'"></ng-include>\n    <div>\n        <div style="{{scrollStyle}}">\n            <div ng-repeat="item in items" class="{{getRowCss(\'sg-gridrow\')}}" ng-class="{true: \'sg-gridrow-active\'}[item.$__selected]" ng-click="clickRow(item,$event)" context-menu="sgMenu" >\n                <a href ng-if="sgAllowDel && !sgReadonly" ng-click="DelObject(item)" class="col-sg-1"><i class= \'fa fa-minus-circle fa-lg sg_gridIcon text-danger\'></i></a>\n                <div class="{{col.$getColumnClass(item)}}" style="{{getCellStyle()}}" ng-repeat="col in columns" title="{{col.$getText(item)}}">\n                    <i ng-if="$first && item.$__selected" class="fa fa-circle"></i>\n                    <i ng-if="col.bool" ng-class="{true: \'fa fa-check\'}[col.$getValue(item)]"></i>\n                    <ng-include  ng-if="!sgReadonly && col.template && (col.template.substr(0,9)==\'readonly_\' || !item.$core || !item.$core())" src="col.template" ng-init="col=col"></ng-include>\n                    <span ng-if="!sgReadonly && col.editTemplate" z-template="col.editTemplate"></span>\n                    <span ng-click="col.$modalEdit(item,$event)" ng-class="{true:\'editable-click\'}[col.modalEdit && !sgReadonly]" ng-if="col.showSpan(item)">{{col.$getText(item)| picker:col.format}}</span>\n                    <i ng-if="$last && item.$core && item.$core()" class="fa fa-lock pull-right sg_gridIcon"></i>\n                </div>\n            </div>\n        </div>\n        <ng-include src="\'template/simplegrid/footer.html\'"></ng-include>\n        <simple-grid-chart ng-if="!!chartCategory"  sc-data="data" sc-category="chartCategory" sc-keylookup=\'chartLookup(col,value)\' sc-series=\'chartSeries\' sc-chart-type="\'area\'" sc-instance="scInstance"></simple-grid-chart>\n    </div>\n</div>')}]),angular.module("template/simplegrid/simpleGrid-simple.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid-simple.html",'<div class="sg-grid">\n    <ng-include src="itemtemplate"></ng-include>\n    <ng-include src="\'template/simplegrid/footer.html\'"></ng-include>\n</div>')}]),angular.module("template/simplegrid/simpleGrid-virtual.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid-virtual.html",'<div class="sg-grid" style="overflow: hidden">\n    <ng-include src="\'template/simplegrid/header.html\'"></ng-include>\n    <div style="{{scrollStyle}}">\n        <div sf-virtual-repeat="item in items" class="row sg-gridrow" ng-click="clickRow(item,$event)" ng-class="{true: \'sg-gridrow-active\'}[item.$__selected]" >\n            <div class="{{col.$getColumnClass()}}" ng-repeat="col in columns">\n                <i ng-if="$first && item.$__selected" class="fa fa-circle"></i>\n                <i ng-if="col.bool" ng-class="{true: \'fa fa-check\'}[col.$getValue(item)]"></i>\n                <a href ng-if="$first && sgAllowDel" ng-click="DelObject(item)"><i class= \'glyphicon glyphicon-remove\'></i></a>\n                <ng-include  ng-if="col.template && (!item.$core || !item.$core())" src="col.template"></ng-include>\n                <span ng-if="!col.template || (item.$core && item.$core())">{{col.$getText(item)}}</span>\n                <i ng-if="$last && item.$core && item.$core()" class="fa fa-lock pull-right sg_gridIcon"></i>\n            </div>\n        </div>\n    </div>\n    <ng-include src="\'template/simplegrid/footer-virtual.html\'"></ng-include>\n</div>')}]),angular.module("template/simplegrid/simpleGrid.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid.html",'<div class="form-horizontal sg-grid">\n    <div>\n        <button type="button" class="btn btn-default"  ng-click="sgAddObject()"  ng-if="sgAddObject"><i class="fa fa-plus"></i> New</button>\n    </div>\n    <div style="{{sgFlexWidth?\'overflow: auto\':\'\'}}">\n        <ng-include src="\'template/simplegrid/header.html\'" ng-if="sgColumns"></ng-include>\n        <div style="{{scrollStyle}}">\n            <div ng-repeat="item in items" style="padding: 3px 0px 3px">\n                <ng-include src="itemtemplate"></ng-include>\n            </div>\n        </div>\n    </div>\n    <ng-include src="\'template/simplegrid/footer.html\'"></ng-include>\n</div>')}]);